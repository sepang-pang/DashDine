<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <!--Viewport-->
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum=scale-1.0, minimum=scale-1.0">

    <!--(IE10)-->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Nomalize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"/>

    <title>DASH DINE</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css">

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=394317cdc40d88fca970b509c1f73eb6&libraries=services"></script>
</head>

<body>
<!-- header -->
<div th:replace="/fragments/header.html"></div>

<!-- 메인 화면 -->
<section id="main_section" style="display: none">
    <div class="image_container">
        <img src="images/main.png" alt="메인 이미지">
        <div class="overlay_text">
            빠르고<br>
            신선하게<br>
            문 앞까지
        </div>
    </div>
</section>

<div th:replace="/owner.html"></div>

<!-- footer -->
<div th:replace="/fragments/footer.html"></div>
</body>
<script src="/js/script.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accessToken = localStorage.getItem('accessToken');
        if (accessToken) {
            const payload = JSON.parse(atob(accessToken.split('.')[1]));
            if (payload.auth === 'OWNER') {
                fetch('/owner', {
                    method: 'GET',
                    headers: {
                        'Authorization': accessToken,
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => {
                    if (response.status === 401) {
                        const newAccessToken = response.headers.get('Authorization');
                        if (newAccessToken) {
                            localStorage.setItem('accessToken', newAccessToken);
                            return fetch('/owner', {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': newAccessToken
                                }
                            })
                        }
                    }
                    })
                    .then(html => {
                        const ownerSection = document.getElementById('owner_main_section');
                        ownerSection.style.display = 'flex';
                        console.log('페이지가 성공적으로 로드되었습니다.');
                    })
                    .catch(error => {
                        console.error('페이지 로드 실패:', error);
                    });

            }
        } else {
            console.error('액세스 토큰이 없습니다.');
            const mainSection = document.getElementById('main_section');
            mainSection.style.display = 'flex';  // 토큰이 없는 경우 기본 메인 섹션을 표시
        }
    });
</script>
</html>
